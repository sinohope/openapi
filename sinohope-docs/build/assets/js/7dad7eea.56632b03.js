"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[1993],{7752:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>l,metadata:()=>o,toc:()=>d});var n=a(87462),r=(a(67294),a(3905));const l={},i="MPC Node User Guide",o={unversionedId:"develop/mpc-waas-api/quick-start/qs-2-node",id:"develop/mpc-waas-api/quick-start/qs-2-node",title:"MPC Node User Guide",description:"1. Sinohope WaaS MPC Technology Introduction",source:"@site/docs/develop/mpc-waas-api/quick-start/qs-2-node.md",sourceDirName:"develop/mpc-waas-api/quick-start",slug:"/develop/mpc-waas-api/quick-start/qs-2-node",permalink:"/docs/develop/mpc-waas-api/quick-start/qs-2-node",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"mpcApiSidebar",previous:{title:"MPC WaaS Quick Start",permalink:"/docs/develop/mpc-waas-api/quick-start/qs-1-waas"},next:{title:"babylon staking",permalink:"/docs/develop/mpc-waas-api/quick-start/qs-3-babylon"}},s={},d=[{value:"1. Sinohope WaaS MPC Technology Introduction",id:"1-sinohope-waas-mpc-technology-introduction",level:2},{value:"2. MPC Node deployment and implementation",id:"2-mpc-node-deployment-and-implementation",level:2},{value:"2.1 Environmental preparation",id:"21-environmental-preparation",level:3},{value:"2.1.1 Common Server Environment",id:"211-common-server-environment",level:4},{value:"Minimum configuration",id:"minimum-configuration",level:5},{value:"Recommended configuration",id:"recommended-configuration",level:5},{value:"2.1.2 TEE server environment",id:"212-tee-server-environment",level:4},{value:"Minimum configuration",id:"minimum-configuration-1",level:5},{value:"Recommended configuration",id:"recommended-configuration-1",level:5},{value:"2.1.3 network requirements",id:"213-network-requirements",level:4},{value:"Firewall inbound rules",id:"firewall-inbound-rules",level:5},{value:"Firewall outbound rules",id:"firewall-outbound-rules",level:5},{value:"2.1.4 install Docker",id:"214-install-docker",level:4},{value:"2.2 Deployment and configuration",id:"22-deployment-and-configuration",level:3},{value:"2.2.1 get and verify the installation package",id:"221-get-and-verify-the-installation-package",level:4},{value:"2.2.2 Initialize Node",id:"222-initialize-node",level:4},{value:"2.2.3 (Optional) Deploy and Configure Callback Service",id:"223-optional-deploy-and-configure-callback-service",level:4},{value:"2.2.4 Bind MPC Node",id:"224-bind-mpc-node",level:4},{value:"2.2.5 unseal MPC Node service",id:"225-unseal-mpc-node-service",level:4},{value:"2.2.6 \u2757\ufe0f\u2757\ufe0f important: database backup",id:"226-\ufe0f\ufe0f-important-database-backup",level:4},{value:"3. MPC Node complete interactive command introduction",id:"3-mpc-node-complete-interactive-command-introduction",level:2},{value:"Start",id:"start",level:3},{value:"Initialization",id:"initialization",level:3},{value:"Unseal the service",id:"unseal-the-service",level:3},{value:"MPC Node Other Commands",id:"mpc-node-other-commands",level:3},{value:"View node-id and callback public key",id:"view-node-id-and-callback-public-key",level:4},{value:"Change password",id:"change-password",level:4},{value:"Stop service",id:"stop-service",level:4},{value:"Manually check the environment",id:"manually-check-the-environment",level:4},{value:"Command to help",id:"command-to-help",level:4},{value:"4. MPC Node callback mechanism",id:"4-mpc-node-callback-mechanism",level:2},{value:"4.1 Configure the callback validation service",id:"41-configure-the-callback-validation-service",level:3},{value:"4.2 Develop callback validation service",id:"42-develop-callback-validation-service",level:3},{value:"4.2.1 signature and verification",id:"421-signature-and-verification",level:4},{value:"1. Generate Request Signature",id:"1-generate-request-signature",level:5},{value:"2. Request signature verification",id:"2-request-signature-verification",level:5},{value:"3. Generate Response Signature",id:"3-generate-response-signature",level:5},{value:"4. Response signature verification",id:"4-response-signature-verification",level:5},{value:"4.2.2 check",id:"422-check",level:4},{value:"1. HTTP interface",id:"1-http-interface",level:5},{value:"2\u3001Request",id:"2request",level:5},{value:"3\u3001Response",id:"3response",level:5},{value:"Data structure",id:"data-structure",level:4},{value:"rawdata_signature",id:"rawdata_signature",level:4},{value:"1. HTTP interface",id:"1-http-interface-1",level:5},{value:"2\u3001 Request",id:"2-request",level:5},{value:"3\u3001Response",id:"3response-1",level:5},{value:"4.3 Activate callback verification service",id:"43-activate-callback-verification-service",level:3},{value:"5. MPC Node Signature Result Encryption",id:"5-mpc-node-signature-result-encryption",level:2},{value:"5.1 Generating Encryption Public and Private Keys",id:"51-generating-encryption-public-and-private-keys",level:3},{value:"5.2 Setting up the Configuration File",id:"52-setting-up-the-configuration-file",level:3},{value:"5.3 Decrypt the signature result",id:"53-decrypt-the-signature-result",level:3}],p={toc:d},u="wrapper";function c(e){let{components:t,...l}=e;return(0,r.kt)(u,(0,n.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"mpc-node-user-guide"},"MPC Node User Guide"),(0,r.kt)("h2",{id:"1-sinohope-waas-mpc-technology-introduction"},"1. Sinohope WaaS MPC Technology Introduction"),(0,r.kt)("p",null,"Threshold Signature Scheme (TSS) is an important branch of digital signature. It is a cryptographic technology based on Secure Multi-Party Computation (MPC) and an important research direction of MPC key management."),(0,r.kt)("p",null,"Sinohope's WaaS (Wallet as a Service) is a wallet-as-a-service solution based on MPC-TSS technology. Sinohope's WaaS service requires customers and the platform to collaborate in a distributed manner, each holding a private key sharding. Based on the ",(0,r.kt)("a",{parentName:"p",href:"https://eprint.iacr.org/2021/060"},"MPC-CMP protocol")," (ECDSA) and ",(0,r.kt)("a",{parentName:"p",href:"https://link.springer.com/chapter/10.1007/3-540-47719-5_33#chapter-info"},"SS01 protocol")," (EdDSA), it implements customer-led off-chain multi-party signatures. MPC Node is a dedicated program package provided by Sinohope WaaS for customers to manage their own private key sharding."),(0,r.kt)("p",null,"Sinohope adopts a 3-3 multi-signature mode, where customers hold one private key sharding and Sinohope holds two private key sharding."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"MPC Node 1: Sinohope is responsible for management, and this Node will always be online."),(0,r.kt)("li",{parentName:"ul"},"MPC Node 2: Sinohope is responsible for management, and this Node will always be online."),(0,r.kt)("li",{parentName:"ul"},"MPC Node 3: The customer is responsible for management and should also keep the automated process always online.")),(0,r.kt)("h2",{id:"2-mpc-node-deployment-and-implementation"},"2. MPC Node deployment and implementation"),(0,r.kt)("h3",{id:"21-environmental-preparation"},"2.1 Environmental preparation"),(0,r.kt)("h4",{id:"211-common-server-environment"},"2.1.1 Common Server Environment"),(0,r.kt)("p",null,"General-purpose servers refer to Cloud as a Service Provider EC or TCE-metal servers operated and maintained independently by customers."),(0,r.kt)("h5",{id:"minimum-configuration"},"Minimum configuration"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"CPU: AMD64 or ARM64 architecture, 2 cores, frequency 2.0 GHz"),(0,r.kt)("li",{parentName:"ul"},"Memory: 4G"),(0,r.kt)("li",{parentName:"ul"},"Hard drive: 64G SSD"),(0,r.kt)("li",{parentName:"ul"},"Operating system: Ubuntu 20.04 or latest. (Note: Theoretically supports all systems that can run Docker)")),(0,r.kt)("h5",{id:"recommended-configuration"},"Recommended configuration"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"CPU: AMD64 or ARM64 architecture, 4 cores, frequency 3.0 GHz"),(0,r.kt)("li",{parentName:"ul"},"Memory: 8G"),(0,r.kt)("li",{parentName:"ul"},"Hard drive: 128G SSD"),(0,r.kt)("li",{parentName:"ul"},"Operating system: Ubuntu 20.04 or latest. (Note: Theoretically supports all systems that can run Docker)")),(0,r.kt)("h4",{id:"212-tee-server-environment"},"2.1.2 TEE server environment"),(0,r.kt)("p",null,"You can refer to Azure's SGX Cloud as a Service to quickly complete the configuration of the machine, ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/zh-cn/azure/confidential-computing/quick-create-marketplace"},"Quick Start: Create an Intel SGX VM in the Azure Marketplace")," . When purchasing a Microsoft Cloud SGX server, please select Ubuntu 20.04 and DCsv3 series support standards. For configuration instructions, please refer to: ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/zh-cn/azure/confidential-computing/virtual-machine-solutions-sgx"},"Solutions on Azure for Intel SGX")," ."),(0,r.kt)("h5",{id:"minimum-configuration-1"},"Minimum configuration"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"CPU: Intel-SGX architecture, 2 cores"),(0,r.kt)("li",{parentName:"ul"},"Memory: 4G"),(0,r.kt)("li",{parentName:"ul"},"Hard drive: 64G SSD"),(0,r.kt)("li",{parentName:"ul"},"Operating System: Ubuntu 20.04")),(0,r.kt)("h5",{id:"recommended-configuration-1"},"Recommended configuration"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"CPU: Intel-SGX architecture, 2 cores")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Memory: 16 G")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Hard drive: 128G SSD")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Operating system: Ubuntu 20.04 or latest. (Note: Theoretically supports all systems that can run Docker)"),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"img",src:a(2064).Z,width:"2756",height:"1416"}))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Check the machine's support for SGX if Azure Cloud as a Service is already configured by default."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"apt install cpuid\ncpuid | grep SGX\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Check the SGX driver installation if Azure Cloud as a Service is configured by default.")),(0,r.kt)("p",null,"If your system supports FLC, make sure your Linux kernel version is 5.11 or higher. You can check with uname -r. If you are unable to upgrade the kernel, you can install the DCAP driver."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"ls /dev/*sgx*\n")),(0,r.kt)("h4",{id:"213-network-requirements"},"2.1.3 network requirements"),(0,r.kt)("h5",{id:"firewall-inbound-rules"},"Firewall inbound rules"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Open port 443, MPC Node service provides HTTPS service to users."),(0,r.kt)("li",{parentName:"ul"},"Turn off all other ports without affecting operation and security.")),(0,r.kt)("h5",{id:"firewall-outbound-rules"},"Firewall outbound rules"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Installation phase:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Access to apt sources to install base dependencies"),(0,r.kt)("li",{parentName:"ul"},"Access docker installation source to install docker"),(0,r.kt)("li",{parentName:"ul"},"Access to docker.io registry mirroring repository"))),(0,r.kt)("li",{parentName:"ul"},"Service phase:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Access to client-configured callback servers"),(0,r.kt)("li",{parentName:"ul"},"Can access mpc-proxy, need to communicate with other MPC nodes when signing."),(0,r.kt)("li",{parentName:"ul"},"Turn off all other outbound IPs without affecting operation and security.")))),(0,r.kt)("h4",{id:"214-install-docker"},"2.1.4 install Docker"),(0,r.kt)("p",null,"Please refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/engine/install/"},"official documentation")," to install Docker. When the startup script in the Sinohope MPC Node installation package is executed, it will automatically check the installation status of Docker. If it is not installed, it cannot run."),(0,r.kt)("h3",{id:"22-deployment-and-configuration"},"2.2 Deployment and configuration"),(0,r.kt)("p",null,"Deploying and configuring MPC Node is a basic requirement for using Sinohope WaaS service. Please refer to the following steps to complete the deployment and operation of MPC Node."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Prepare: Open Sinohope WaaS account; Prepare deployment environment, obtain and verify MPC Node installation package."),(0,r.kt)("li",{parentName:"ol"},"Initialize the node, generate the node ID and the node public key required for deploying the callback service."),(0,r.kt)("li",{parentName:"ol"},"(On demand) Deploy and configure your callback service;"),(0,r.kt)("li",{parentName:"ol"},"Bind MPC Node, log in to the web console to configure MPC Node, and bind your Node ID with your organization account."),(0,r.kt)("li",{parentName:"ol"},'Start MPC Node, the node will continue to run and automatically drive the operation of MPC protocol as needed. DKG will be completed after a moment, and then the "key share status" will be "generated" in the Web Console MPC Node management interface.'),(0,r.kt)("li",{parentName:"ol"},"\u2757\ufe0f\u2757\ufe0f important: back up MPC Node local database files safely and properly!")),(0,r.kt)("h4",{id:"221-get-and-verify-the-installation-package"},"2.2.1 get and verify the installation package"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Software packages (mainly management scripts and configuration files) are released through open source projects. Download link: ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/sinohope/sinohope-mpc-node/releases"},"sinohope-mpc-node/releases"),". The programs located under ",(0,r.kt)("inlineCode",{parentName:"li"},"env/general")," are used in the normal CPU environment, and the programs located under ",(0,r.kt)("inlineCode",{parentName:"li"},"env/intel-sgx")," are used in the Intel sgx CPU environment."),(0,r.kt)("li",{parentName:"ul"},"The Releases page will contain the sha256 value of the main content. Please check the consistency of the hash value after downloading the content to the target location.")),(0,r.kt)("p",null,"The required initial files are as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Bash"},"sinohope-mpc-node\n\u251c\u2500\u2500 config.toml \uff08Configuration File\uff09\n\u2514\u2500\u2500 node.sh \uff08Manage Scripts\uff09\n")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The node.sh script is used to control the behavior of the mpc-node service, such as generating shard private keys, starting services, etc. Executing ",(0,r.kt)("inlineCode",{parentName:"li"},"./node.sh help")," will get instructions for all commands."),(0,r.kt)("li",{parentName:"ol"},"The config.toml example and description are as follows:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'[app]\n# The name of the software is reflected in the log.\nname = "mpc-node"\n# 3 shards, a, b, c. Cannot be modified.\nparty-id = "a"\n# User type, cannot be modified.\naccount-type = "2"\n\n# log\n[log]\n# Log level: 0: Panic 1: Fatal 2: Error 3: Warn 4: Info 5: Debug 6: Trace\n[log.stdout]\n# Whether to enable terminal log output\nenable=true\n  # Log level\nlevel=6\n\n[log.file]\n# Whether to enable file log output\nenable=true\n# Log level\nlevel=6\n# The log file path is the internal path of docker. When node.sh start is executed, the current directory will be mapped to /tmp/mpc-node in docker.\npath = "/tmp/mpc-node/logs/mpc-node.log"\n\n# Shard storage\n[storage]\n# Storage engine type, divided into bolt and sgx, the default is bolt. Bolt is file database storage, and sgx is text file storage. If using the intel-sgx-tee environment, it must be specified as sgx storage.\nengine = "bolt"\n# t/n The combined password can be a 1/1 password or a 2/3 password. Just enter any two passwords. If t>1, the password must be generated by a special tool and cannot be generated freely.\nt=1\nn=2\n# The fragmented data storage path is the internal path of docker.\ndb-file-path = "/tmp/mpc-node/asset.db"\n# The service address and port are the internal address and port of docker.\nunseal-server-address = "0.0.0.0:8080"\n\n# mpc server is responsible for connecting three mpc nodes.\n[mpc-service]\n# node needs to use websocket to establish a connection with mpc server\nprotocol = "wss" .\n  #URL address of mpc server\naddress = "api-pre.sinohope.com"\n# URL path of mpc server\npath = "/proxy"\n\n# Encryption of "signature result", mpc encrypts the raw_data signature result once, so that others cannot use it even if they get the signature result.\n[encrypt-signature]\n# Whether to enable\nenable=true\n# The Secp256r1 public key path used for encryption is the internal path of docker.\npublic-key-path = "/tmp/mpc-node/encrypt_sig_public.pem"\n\n# Signature callback service. Before signing, mpc-node sends the data to be signed to the callback service, and the callback checks whether the signature is allowed.\n[callback]\nretry-times=60\nsleep-seconds = 60\n# callback list, if the list is empty, the callback will not take effect.\n[[callback.server]]\n# callback address\naddress = "http://10.151.100.41:9090"\n# The result returned by mpc-node calling callback is signed using the Secp256r1 private key. mpc-node verifies the correctness of the signature through the public key. The path of the public key is the internal path of docker.\npublic-key-path = "/tmp/mpc-node/callback_server_public.pem"\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"After successful initialization of MPC Node, the asset.db file and logs directory will be automatically created.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-JSON"},"sinohope-mpc-node\n\u251c\u2500\u2500 config.toml\n\u251c\u2500\u2500 node.sh\n\u251c\u2500\u2500 asset.db (Important locally generated data is stored here, and backup and recovery are the process of restoring data)\n\u2514\u2500\u2500 logs (Log file directory)\n")),(0,r.kt)("h4",{id:"222-initialize-node"},"2.2.2 Initialize Node"),(0,r.kt)("p",null,"First, execute the following command to start the mpc-node service. The service must be started before executing any other commands."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo ./node.sh start\n")),(0,r.kt)("p",null,"\u793a\u4f8b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"./node.sh start\nmpc-node instance name: mpc-node, unseal server address: 127.0.0.1:10080\na0c4e4380926d588016570a5d99a7b875a997c841d70472a4bcf1972b200ec49\nmpc-node server address: 127.0.0.1:10080\n")),(0,r.kt)("p",null,"Note: Firstly, the script will automatically perform some environmental checks, such as determining whether Docker is installed and determining user permissions. If you need to run multiple mpc-nodes simultaneously on the current system, you need to distinguish them in the form of directories. If you try to run multiple mpc-nodes in the same directory, only the first initialized node can run normally. If you want to run two mpc-nodes, their names are assumed to be mpc-node-a and mpc-node-b, then you need to create two directories, their names can be: mpc-node-a and mpc-node-b. Then copy the node.sh and config.toml files to the above two directories respectively."),(0,r.kt)("p",null,"When deploying MPC Node for the first time, please execute the following command on the command line and complete the initialization according to the prompts."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Bash"},"sudo ./node.sh init\n")),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Shell"},'./node.sh init\nNew password:\nRetype new password:\n{"data":{"node_id":"sinoMzA1OTMwMTMwNjA3MmE4NjQ4Y2UzZDAyMDEwNjA4MmE4NjQ4Y2UzZDAzMDEwNzAzNDIwMDA0MDdlMDgyNzA5OTU1NTUxMzljODExMzQ3YTBkZjVmZjVhYmY1ZmM1MTFiOWFiM2U0MWE5N2MwMDlkODA3OGY3ZTc1MzlhYjA2M2ZkNzczZTliOTJjZWU5MjI1ZTVhMTFhYmJjNzExOWRlNDkwYjNiMzZkNTM3MWFmZDRkYjBiYzI=","public_key":"-----BEGIN PUBLIC KEY-----\\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEB+CCcJlVVROcgRNHoN9f9av1/FEb\\nmrPkGpfACdgHj351OasGP9dz6bks7pIl5aEau8cRneSQs7NtU3Gv1NsLwg==\\n-----END PUBLIC KEY-----\\n"},"status":"ok"}\n')),(0,r.kt)("p",null,"The main task of the init command is to initialize node information, including:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Set a password for the MPC node This password is used to protect your private key sharding and other private data. Please keep it properly, do not leak it, and do a Safety Redundancy backup . The node will be required to enter the password when it starts up."),(0,r.kt)("li",{parentName:"ul"},"Create a node ID. Each MPC node has a unique identifier ID. You will need to use this node ID to uniquely associate your MPC node with your WaaS organization account."),(0,r.kt)("li",{parentName:"ul"},"Create an ECDSA key pair when communicating with the callback-server.")),(0,r.kt)("p",null,"Password Instructions:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The password must include uppercase letters, lowercase letters, numbers, and special characters, with a length of at least 12 characters."),(0,r.kt)("li",{parentName:"ul"},"For the sinohope-mpc-node password, it adopts the t-n combination method, where t must be less than or equal to n (e.g., for 2/3, only 2 segments of the password are required during initialization and unsealing)."),(0,r.kt)("li",{parentName:"ul"},"If ",(0,r.kt)("inlineCode",{parentName:"li"},"storage.t")," in the configuration is set to 1, the operation command only needs to be executed once, and the password can be manually created."),(0,r.kt)("li",{parentName:"ul"},"If ",(0,r.kt)("inlineCode",{parentName:"li"},"storage.t")," in the configuration is greater than 1, the operation command needs to be executed t times, and t-n passwords need to be generated using specialized tools and cannot be created arbitrarily. ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/sinohope/shamir-pasasword"},"click to get the password generation tool")),(0,r.kt)("li",{parentName:"ul"},"T-n passwords require manual modification of ",(0,r.kt)("inlineCode",{parentName:"li"},"storage.t")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"storage.n")," in the config.toml file.")),(0,r.kt)("h4",{id:"223-optional-deploy-and-configure-callback-service"},"2.2.3 (Optional) Deploy and Configure Callback Service"),(0,r.kt)("p",null,"MPC Node provides a callback mechanism for you to perform risk control, and this callback service is optional (in production environments, it is strongly recommended that you develop and deploy callback services)."),(0,r.kt)("p",null,"After configuring the callback service for the MPC Node, the MPC Node will call back the specified interface before initiating any MPC business (such as signing), requesting authorization from the callback service for the current MPC business. Only when your callback service explicitly returns the ACCEPT status, will the MPC business begin to execute."),(0,r.kt)("p",null,"In addition, when you use the function of message signing or direct signing of the original data source, MPC Node will provide the signing result to you through the callback interface for your business use."),(0,r.kt)("p",null,'For details on the development, deployment, and configuration of callback services, please refer to the "MPC Node callback mechanism" section.'),(0,r.kt)("h4",{id:"224-bind-mpc-node"},"2.2.4 Bind MPC Node"),(0,r.kt)("p",null,'After completing the previous steps, you can log in to Sinohope Web Console with an account with administrator privileges, and complete the association binding of MPC Node on the "Settings" - "MPC Node" page. Here, you need to enter the Node ID generated during MPC Node initialization.'),(0,r.kt)("h4",{id:"225-unseal-mpc-node-service"},"2.2.5 unseal MPC Node service"),(0,r.kt)("p",null,"After binding the MPC Node, start the MPC Node service with the following command."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Bash"},"sudo ./node.sh unseal \n")),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-JSON"},'./node.sh unseal\n? Enter current password: \n{"data":"in-bkey success","status":"ok"}\n')),(0,r.kt)("p",null,'After the service starts running, return to the web console MPC Node configuration interface. Normally, wait a moment to see the "key share status" as "generated". At the same time, the interface will display your organization\'s MPC root public key information.'),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"img",src:a(76219).Z,width:"1953",height:"760"})),(0,r.kt)("h4",{id:"226-\ufe0f\ufe0f-important-database-backup"},"2.2.6 \u2757\ufe0f\u2757\ufe0f important: database backup"),(0,r.kt)("p",null,"The MPC Node local database file  ",(0,r.kt)("inlineCode",{parentName:"p"},"asset.db"),"  stores important data such as your private key sharding, all encrypted using a strong key derived from the password you set for MPC Node via the KDF function."),(0,r.kt)("p",null,"Private key sharding is related to the security and availability of funds. The private key sharding managed by Sinohope is safeguarded and backed up by a series of highly available and disaster recovery solutions based on multi-level and multi-region platforms. At the same time, you can also apply for backup of all sharding private keys of your organization, thus fully controlling all three sharding private keys."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"And for the private key sharding that exists in your local database file, you must complete the Safety Redundancy backup by yourself. Please take sufficient security measures, remote multiple copies, backup your database file, and the password you set for MPC Node.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"It is recommended that database files be kept separate from passwords to reduce the risk of data leakage.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"If your MPC Node server or service fails, data is damaged, or becomes unavailable in the future, you can only restore it by redeploying the MPC Node service with the database, files, and passwords you backed up. Sinohope will not be able to help you restore your MPC Node service!!")),(0,r.kt)("h2",{id:"3-mpc-node-complete-interactive-command-introduction"},"3. MPC Node complete interactive command introduction"),(0,r.kt)("h3",{id:"start"},"Start"),(0,r.kt)("p",null,"Please execute the following command in the command line:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Bash"},"sudo ./node.sh start\n")),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Shell"},"./node.sh start\nmpc-node instance name: mpc-node, unseal server address: 127.0.0.1:10080\na0c4e4380926d588016570a5d99a7b875a997c841d70472a4bcf1972b200ec49\nmpc-node server address: 127.0.0.1:10080\n")),(0,r.kt)("h3",{id:"initialization"},"Initialization"),(0,r.kt)("p",null,"Please execute the following command in the command line:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Bash"},"sudo ./node.sh init\n")),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Shell"},'./node.sh init\nNew password:\nRetype new password:\n{"data":{"node_id":"sinoMzA1OTMwMTMwNjA3MmE4NjQ4Y2UzZDAyMDEwNjA4MmE4NjQ4Y2UzZDAzMDEwNzAzNDIwMDA0MDdlMDgyNzA5OTU1NTUxMzljODExMzQ3YTBkZjVmZjVhYmY1ZmM1MTFiOWFiM2U0MWE5N2MwMDlkODA3OGY3ZTc1MzlhYjA2M2ZkNzczZTliOTJjZWU5MjI1ZTVhMTFhYmJjNzExOWRlNDkwYjNiMzZkNTM3MWFmZDRkYjBiYzI=","public_key":"-----BEGIN PUBLIC KEY-----\\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEB+CCcJlVVROcgRNHoN9f9av1/FEb\\nmrPkGpfACdgHj351OasGP9dz6bks7pIl5aEau8cRneSQs7NtU3Gv1NsLwg==\\n-----END PUBLIC KEY-----\\n"},"status":"ok"}\n')),(0,r.kt)("h3",{id:"unseal-the-service"},"Unseal the service"),(0,r.kt)("p",null,"Please execute the following command in the command line:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Bash"},"./node.sh unseal \n")),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-JSON"},'./node.sh unseal\n? Enter current password: \n{"data":"in-bkey success","status":"ok"}\n')),(0,r.kt)("p",null,"Note: The script will read the password and start the service in docker"),(0,r.kt)("h3",{id:"mpc-node-other-commands"},"MPC Node Other Commands"),(0,r.kt)("p",null,"Note: The main commands to start the service are init and start. Other commands are optional and can be consulted as needed."),(0,r.kt)("h4",{id:"view-node-id-and-callback-public-key"},"View node-id and callback public key"),(0,r.kt)("p",null,"This command can view the MPC Node ID and callback service communication public key, and can only be used when the MPC Node is running."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-JSON"},"./node.sh info\n")),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Shell"},'./node.sh info   \n{\n  "data": {\n    "node_id": "sinoMzA1OTMwMTMwNjA3MmE4NjQ4Y2UzZDAyMDEwNjA4MmE4NjQ4Y2UzZDAzMDEwNzAzNDIwMDA0MmFmNGY0Y2I5ZmM1MGFjMWUzNzIxMzM2Y2IyMmJmYzMzMDg4YjJmNGM4OTEyZjZhNDE4ZmNlY2JmZWFhMzIwMjNlMzg0MGE1YjBkODI3YWE5ODE1N2Y1MTE5Y2M2YTdiYzQ2NWNmN2EzNzc0MTkwNjdmYzc5ZGNjMjQ0YjgxZTU=",\n    "public_key": "-----BEGIN PUBLIC KEY-----\\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEKvT0y5/FCsHjchM2yyK/wzCIsvTI\\nkS9qQY/Oy/6qMgI+OEClsNgnqpgVf1EZzGp7xGXPejd0GQZ/x53MJEuB5Q==\\n-----END PUBLIC KEY-----\\n",\n    "state": "unsealed"\n  },\n  "status": "ok"\n}\n')),(0,r.kt)("h4",{id:"change-password"},"Change password"),(0,r.kt)("p",null,"This command is used to modify the MPC Node password. Enter old password, Please make sure that the MPC Node is in normal operation (complete MPC Node binding, and the node is online normally)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-JSON"},"./node.sh reset\n")),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-JSON"},'./node.sh reset\n? Enter current password: \nNew password:\nRetype new password:\n{"status": "ok", "data": "re-bkey-init success"}\n\nThis command is used to modify the MPC Node password. Enter a new password, Please make sure that the MPC Node is in normal operation (complete MPC Node binding, and the node is online normally).\n\n```JSON\n./node.sh cmreset\n')),(0,r.kt)("p",null,"\u793a\u4f8b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-JSON"},'./node.sh cmreset\nNew password:\nRetype new password:\n{"status": "ok", "data": "re-bkey success"}\n')),(0,r.kt)("h4",{id:"stop-service"},"Stop service"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Bash"},"./node.sh stop\n")),(0,r.kt)("h4",{id:"manually-check-the-environment"},"Manually check the environment"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Bash"},"./node.sh check\n")),(0,r.kt)("h4",{id:"command-to-help"},"Command to help"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Bash"},"./node.sh help\n")),(0,r.kt)("h2",{id:"4-mpc-node-callback-mechanism"},"4. MPC Node callback mechanism"),(0,r.kt)("p",null,"After starting up, MPC Node will automatically establish a long link with Sinohope backend to receive tasks sent by Sinohope backend. By default, MPC Node does not enable callback mechanism, and MPC Node will automatically complete the execution of all tasks."),(0,r.kt)("p",null,"If the callback mechanism is enabled, the customer needs to develop a callback verification service to verify whether the tasks issued by Sinohope are reasonable and ultimately decide whether to cooperate with Sinohope to complete the signature."),(0,r.kt)("p",null,"The development of callback service can refer to the callback service example provided by Sinohope: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/sinohope/mpc-node-callback-demo"},"GitHub - sinohope/mpc-node-callback-demo")),(0,r.kt)("h3",{id:"41-configure-the-callback-validation-service"},"4.1 Configure the callback validation service"),(0,r.kt)("p",null,"Some initialization configuration work needs to be done on the host where the callback server is deployed. The specific steps are as follows:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Generate ECDSA private key for callback server")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Go"},"openssl ecparam -genkey -name prime256v1 -out private_key.pem\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Export the ECDSA public key of the callback server")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Go"},"openssl ec -in private_key.pem -pubout -out callback_server_public.pem\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Copy the exported ECDSA public key (i.e. callback_server_public file) to the machine where the MPC Node is located, and specify the location of the callback_server_public file in the MPC Node configuration file:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-TOML"},'[callback]\nretry-times = 60\nsleep-seconds = 60\n[[callback.server]]\n  address = "http://<callback url>"\n  public-key-path = "./callback_server_public.pem"\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Copy the MPC Node's ECDSA public key to the callback server related configuration file")),(0,r.kt)("p",null,"How to obtain the ECDSA public key of MPC Node:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"After the initialization of MPC Node is completed, the ECDSA public key of MPC Node can be queried by the following command:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-TOML"},"./node.sh info\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Example output:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Shell"},'./node.sh info   \nchecking update...\n{\n  "data": {\n    "node_id": "sinoMzA1OTMwMTMwNjA3MmE4NjQ4Y2UzZDAyMDEwNjA4MmE4NjQ4Y2UzZDAzMDEwNzAzNDIwMDA0MmFmNGY0Y2I5ZmM1MGFjMWUzNzIxMzM2Y2IyMmJmYzMzMDg4YjJmNGM4OTEyZjZhNDE4ZmNlY2JmZWFhMzIwMjNlMzg0MGE1YjBkODI3YWE5ODE1N2Y1MTE5Y2M2YTdiYzQ2NWNmN2EzNzc0MTkwNjdmYzc5ZGNjMjQ0YjgxZTU=",\n    "public_key": "-----BEGIN PUBLIC KEY-----\\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEKvT0y5/FCsHjchM2yyK/wzCIsvTI\\nkS9qQY/Oy/6qMgI+OEClsNgnqpgVf1EZzGp7xGXPejd0GQZ/x53MJEuB5Q==\\n-----END PUBLIC KEY-----\\n",\n    "state": "unsealed"\n  },\n  "status": "ok"\n}\n')),(0,r.kt)("p",null,"The public key is the ECDSA public key used by MPC Node for callback service."),(0,r.kt)("h3",{id:"42-develop-callback-validation-service"},"4.2 Develop callback validation service"),(0,r.kt)("h4",{id:"421-signature-and-verification"},"4.2.1 signature and verification"),(0,r.kt)("p",null,"The data between MPC Node and callback service is signed by their respective ECDSA private keys, and then the other party uses the pre-configured public key to verify the signature according to the specified rules. Only when the signature is passed can it be considered a legitimate request."),(0,r.kt)("p",null,"The following is the data structure for communication between the current MPC Node and the callback service. Please be careful not to change the order of fields arbitrarily."),(0,r.kt)("p",null,"Request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Go"},'type Check struct {\n    CallbackId    string `json:"callback_id,omitempty"`\n    RequestType   string `json:"request_type,omitempty"`\n    RequestDetail `json:"request_detail,omitempty"`\n    ExtraInfo     `json:"extra_info,omitempty"`\n}\n\ntype RequestDetail struct {\n    T            int      `json:"t,omitempty"`\n    N            int      `json:"n,omitempty"`\n    Cryptography string   `json:"cryptography,omitempty"`\n    PartyIds     []string `json:"party_ids,omitempty"`\n\n    PublicKey   string `json:"public_key,omitempty"`\n    Path        string `json:"path,omitempty"`\n    Message     string `json:"message,omitempty"`\n    Coin        string `json:"coin,omitempty"`\n    FromAddress string `json:"from_address,omitempty"`\n    ToAddress   string `json:"to_address,omitempty"`\n    Amount      string `json:"amount,omitempty"`\n    Fee         string `json:"fee,omitempty"`\n    GasPrice    string `json:"gas_price,omitempty"`\n    GasLimit    string `json:"gas_limit,omitempty"`\n    Signature   string `json:"signature,omitempty"`\n}\n\ntype ExtraInfo struct {\n    SinoId    string `json:"sino_id,omitempty"`\n    RequestId string `json:"request_id,omitempty"`\n}\n')),(0,r.kt)("p",null,"Response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Go"},'type Response struct {\n    Status    string        `json:"status,omitempty"`\n    Error     string        `json:"error,omitempty"`\n    Data      *ResponseData `json:"data,omitempty"`\n    Signature string        `json:"signature,omitempty"`\n}\n\ntype ResponseData struct {\n    CallbackId string `json:"callback_id,omitempty"`\n    SinoId     string `json:"sino_id,omitempty"`\n    RequestId  string `json:"request_id,omitempty"`\n    Action     string `json:"action,omitempty"`\n    WaitTime   string `json:"wait_time,omitempty"`\n}\n')),(0,r.kt)("h5",{id:"1-generate-request-signature"},"1. Generate Request Signature"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"MPC Node constructs a Check structure based on the type of request."),(0,r.kt)("li",{parentName:"ul"},"Serialize the constructed Check structure in JSON to obtain the Message."),(0,r.kt)("li",{parentName:"ul"},"MPC Node uses its own ECDSA private key to sign the message and obtain the signature."),(0,r.kt)("li",{parentName:"ul"},"MPC Node sets Signature to the HTTP request header, with Key as Sigature.")),(0,r.kt)("h5",{id:"2-request-signature-verification"},"2. Request signature verification"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The callback service uses the Check structure to parse the HTTP request of the MPC Node and obtain the Check data of this request."),(0,r.kt)("li",{parentName:"ul"},"The callback service serializes the Check data obtained in JSON to obtain the Message to be verified."),(0,r.kt)("li",{parentName:"ul"},"The callback service obtains the Signature from the HTTP request, and then verifies the Signature by combining Mesage and the pre-configured MPC Node public key.")),(0,r.kt)("h5",{id:"3-generate-response-signature"},"3. Generate Response Signature"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The callback service generates the above Response based on its own decision and fills the corresponding fields in the Response.Data."),(0,r.kt)("li",{parentName:"ul"},"The callback service serializes the Response.Data in JSON to obtain the Message."),(0,r.kt)("li",{parentName:"ul"},"The callback service uses its own ECDSA private key to sign the Message, obtains the Signature, and assigns the Signature to the Response. Signature field.")),(0,r.kt)("h5",{id:"4-response-signature-verification"},"4. Response signature verification"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"MPC Node receives the response of the callback service and serializes the Response.Data field in JSON to obtain the Message."),(0,r.kt)("li",{parentName:"ul"},"MPC Node verifies Response. Signature by combining Message and pre-configured callback service public key.")),(0,r.kt)("h4",{id:"422-check"},"4.2.2 check"),(0,r.kt)("p",null,"Each time the keygen and sign business mpc-node will request the user for risk control through the check interface. Only when the callback service explicitly replies Approve can the relevant business be allowed to start."),(0,r.kt)("h5",{id:"1-http-interface"},"1. HTTP interface"),(0,r.kt)("p",null,"path: /check"),(0,r.kt)("p",null,"method: post"),(0,r.kt)("p",null,"Body: JSON-encoded data"),(0,r.kt)("h5",{id:"2request"},"2\u3001Request"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u53c2\u6570"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"callback_id"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"callback request unique ID")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"request_type"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"callback request is a string type, there are four values: keygen, sign,  bip340-schnorr-sign, taproot-sign")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"request_detail"),(0,r.kt)("td",{parentName:"tr",align:null},"struct"),(0,r.kt)("td",{parentName:"tr",align:null},"Callback request details, including a series of key information of the request. Different callback request types correspond to different request_detail structures; the format is JSON serialized string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"extra_info"),(0,r.kt)("td",{parentName:"tr",align:null},"struct"),(0,r.kt)("td",{parentName:"tr",align:null},"callback request auxiliary information, including some additional relevant information of the request; format is JSON serialized string")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"When request_type == keygen , the request_detail structure is defined as follows:")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Threshold"),(0,r.kt)("td",{parentName:"tr",align:null},"int"),(0,r.kt)("td",{parentName:"tr",align:null},"signature threshold")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"party_ids"),(0,r.kt)("td",{parentName:"tr",align:null},"[]string"),(0,r.kt)("td",{parentName:"tr",align:null},"Collection of node IDs involved in generating private keys")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Cryptography"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"signature algorithm. ecdsa-secp256k1/eddsa-ed25519")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"When request_type is sign or bip340-schnorr-sign or taproot-sign, the request_detail structure is defined as follows:")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"sign_type"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Transaction type to be signed: 1. Ordinary transaction; 2. EIP191/EIP712 signature; 3. RawData signature;")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"public_key"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"public key corresponding to the root public key")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"path"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"bip32 derived path")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"message"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"message to be signed")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"tx_info"),(0,r.kt)("td",{parentName:"tr",align:null},"json"),(0,r.kt)("td",{parentName:"tr",align:null},"Transaction Details")))),(0,r.kt)("p",null,"The structure of tx_info is defined as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"VaultId"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"vault id")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"WalletId"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"wallet id")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"requestId"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"requestId of the requestor transaction")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"chainSymbol"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"chain identifier")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"AssetId"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"asset id")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"From"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"from address")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"To"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"to address")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"toTag"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"transaction memo")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Amount"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"amount")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Fee"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"handling fee, for transactions on non-EVM compatible chains of UTXO class, self-set fee, if")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"gasPrice"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"gasprice")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"gasLimit"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"gaslimit")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Inputdata"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Ethereum transaction data")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"note"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"note: Some remarks information that users need.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"curInputId"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"inputId of signature data")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"tapScriptRoot"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"The tree root of taproot script")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"publickKey"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"The public key of the from address")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"extraData"),(0,r.kt)("td",{parentName:"tr",align:null},"json"),(0,r.kt)("td",{parentName:"tr",align:null},"Detailed data of utxo transactions, including vin, vout")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"brc20Details"),(0,r.kt)("td",{parentName:"tr",align:null},"json"),(0,r.kt)("td",{parentName:"tr",align:null},"brc20Details")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"runeDetails"),(0,r.kt)("td",{parentName:"tr",align:null},"json"),(0,r.kt)("td",{parentName:"tr",align:null},"runeDetails")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Structure example of brc20Details:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'[\n            {\n                "method": "transfer",\n                "ticker": "helloworkd",\n                "quantity": "920769938",\n                "inscriptionId": "affabbd94763045fb4bc4****************************************0",\n                "step": 3,\n                "from": "1Bt84h23CKi****************",\n                "to": "bc1q53ss0p87****************"\n            }\n]\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Structure example of runeDetails:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'[\n    {\n        "fromAddress": "1Bt84h23CKi****************",\n        "toAddress": "bc1q53ss0p87****************",\n        "runeName": "HELLOWORLD",\n        "runeId": "2818544:3897",\n        "runeSpacedName": "HELLO\u2022WORLD",\n        "runeAmount": "100",\n        "runeSymbol": "\xa4",\n        "runeDivisibility": 0\n    }\n]\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Structure example of extraData:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n    "toTag": "TOTAG1637",\n    "vinList": [\n        {\n            "address": "mwTnMZzAvUzVCQKGkdcAHYW1sMnJCumbJL",\n            "amount": 1425593,\n            "blockHash": "0000000000000005f9c6962d86854e412bf0cc1d61b5849c0ac2f83d701007a8",\n            "blockHeight": 2583605,\n            "blockState": 1,\n            "blockTimeStamp": 1711441887,\n            "currency": "btc",\n            "id": 6909,\n            "state": 0,\n            "tag": "",\n            "transactionHash": "17b0378f551ddfda5d512a7304fdc0f33493f0429a479e243f3653d7dca0700e",\n            "voutIndex": 1\n        }\n    ],\n    "voutList": [\n        {\n            "address": "mwTnMZzAvUzVCQKGkdcAHYW1sMnJCumbJL",\n            "amount": 22000\n        }\n    ]\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"extra_info structure is defined as follows:")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"sino_id"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Sinohope's internal unique identifier for the business corresponding to the current signature, which is provided in the response when developers call waas APIs such as create_transfer .")))),(0,r.kt)("h5",{id:"3response"},"3\u3001Response"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Status"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"status code, when the status code is 0, it indicates that the callback server is executing normally; when the status code is other values, it indicates that some abnormal situations occurred during the execution of the callback server")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Error"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Error message; When the return value of status is not 0, it represents the error message that appears internally in the callback server; When the status is 0 and the risk control result is REJECT, it represents the specific risk control rejection information.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Data"),(0,r.kt)("td",{parentName:"tr",align:null},"json"),(0,r.kt)("td",{parentName:"tr",align:null},"requested result data")))),(0,r.kt)("h4",{id:"data-structure"},"Data structure"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"callback_id"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"callback_id of this request")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"sino_id"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"sino_id of this request")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"request_id"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"request_id of this request")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Action"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Processing result of this request: Approve: Allow Reject: Reject Wait: Retry after waiting")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"wait_time"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"When action is Wait, this field is used to indicate how long the MPC Node needs to wait, in seconds")))),(0,r.kt)("h4",{id:"rawdata_signature"},"rawdata_signature"),(0,r.kt)("p",null,"Only when the sign_type of the sign service is 2 or 3 and the MPC Node signature is successful will the original message and signature result be reported to the callback service."),(0,r.kt)("h5",{id:"1-http-interface-1"},"1. HTTP interface"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"path: /rawdata_signature"),(0,r.kt)("p",{parentName:"blockquote"},"method: post"),(0,r.kt)("p",{parentName:"blockquote"},"body: JSON-encoded data")),(0,r.kt)("h5",{id:"2-request"},"2\u3001 Request"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"callback_id"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"callback request unique ID")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"request_detail"),(0,r.kt)("td",{parentName:"tr",align:null},"struct"),(0,r.kt)("td",{parentName:"tr",align:null},"Callback request details, including a series of key information of the request. Different callback request types correspond to different request_detail structures; the format is JSON serialized string")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"extra_info"),(0,r.kt)("td",{parentName:"tr",align:null},"struct"),(0,r.kt)("td",{parentName:"tr",align:null},"callback request auxiliary information, including some additional relevant information of the request; different callback request types correspond to different extra_info structures; the format is JSON serialized string")))),(0,r.kt)("p",null,"request_defailt as follows:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Message"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Original message to be signed")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Signature"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"signature result")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"extra_info structure is defined as follows:")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"sino_id"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Sinohope's internal unique identifier for the business corresponding to the current signature, which is provided in the response when developers call waas APIs such as create_transfer .")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"request_id"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"The request ID passed in by the user through the WaaS interface. If the request is not a WaaS interface, Sinohope will automatically generate it internally")))),(0,r.kt)("h5",{id:"3response-1"},"3\u3001Response"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Status"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"status code, when the status code is 0, it indicates that the callback server is executing normally; when the status code is other values, it indicates that some abnormal situations occurred during the execution of the callback server")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Error"),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Error message; When the return value of status is not 0, it represents the error message that appears internally in the callback server; When the status is 0 and the risk control result is REJECT, it represents the specific risk control rejection information.")))),(0,r.kt)("h3",{id:"43-activate-callback-verification-service"},"4.3 Activate callback verification service"),(0,r.kt)("p",null,"After the callback validation service is configured and started, you need to call./node.sh start to restart the MPC Node."),(0,r.kt)("h2",{id:"5-mpc-node-signature-result-encryption"},"5. MPC Node Signature Result Encryption"),(0,r.kt)("p",null,"For users deploying an independent mpc-node, the mpc-node can encrypt the signature result when calling the /",(0,r.kt)("inlineCode",{parentName:"p"},"v1/waas/mpc/web3/sign_message")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"/v1/waas/mpc/wallet/advance/sign_raw_data")," interfaces for signing."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Encryption uses the Secp256r1 algorithm, with public key encryption and private key decryption."),(0,r.kt)("li",{parentName:"ul"},"When user query the signature result using the interface ",(0,r.kt)("inlineCode",{parentName:"li"},"/v1/waas/mpc/web3/sign_result"),", they need to decrypt it before using it."),(0,r.kt)("li",{parentName:"ul"},"If the mpc-node is configured with a Callback callback service, the signature results received by the callback service also need to be decrypted before use.")),(0,r.kt)("h3",{id:"51-generating-encryption-public-and-private-keys"},"5.1 Generating Encryption Public and Private Keys"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"openssl ecparam -genkey -name prime256v1 -out decrypt_sig_pirvate.pem\nopenssl ec -in decrypt_sig_pirvate.pem -pubout -out encrypt_sig_public.pem\n")),(0,r.kt)("h3",{id:"52-setting-up-the-configuration-file"},"5.2 Setting up the Configuration File"),(0,r.kt)("p",null,"Enable signature result encryption in the config.toml configuration file and specify the public key for encryption."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'[encrypt-signature]\nenable=true\npublic-key-path = "/tmp/mpc-node/encrypt_sig_public.pem"\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"If ",(0,r.kt)("inlineCode",{parentName:"li"},"encrypt-signature.enable = true"),", the mpc-node will encrypt the signature result; otherwise, it returns the original signature result.\n",(0,r.kt)("inlineCode",{parentName:"li"},"encrypt-signature.public-key-path")," is the public key for encrypting the signature result, in PEM format."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"callback.server.public-key-path")," is used for data verification between the mpc-node and the Callback service. The Callback service signs the communication data with a private key, and the mpc-node verifies the data using this public key, in PEM format."),(0,r.kt)("li",{parentName:"ul"},"Both ",(0,r.kt)("inlineCode",{parentName:"li"},"encrypt-signature.public-key-path")," and `callback.server.public-key-path`` use the Secp256r1 algorithm. For simplicity, it is recommended to use the same public-private key pair.")),(0,r.kt)("h3",{id:"53-decrypt-the-signature-result"},"5.3 Decrypt the signature result"),(0,r.kt)("p",null,"In the callback service demo, decryption processing is performed on the callback result (encrypted signature data), which can be referred to in the callback service example provided by Sinohope: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/sinohope/mpc-node-callback-demo"},"GitHub - sinohope/mpc-node-callback-demo")))}c.isMDXComponent=!0},76219:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/mpc-node-c68a2d846433981c1e03c415271b6a6f.png"},2064:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/sgx-95e28b80c9f36854e2139ded34492f6e.png"}}]);